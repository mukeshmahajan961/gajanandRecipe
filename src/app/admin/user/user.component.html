<header class="d-flex justify-content-between m-3 bg-secondary text-light p-2">
    <h4>Users list</h4>
  <button class="btn btn-sm btn-light" aria-label="Add User" data-bs-toggle="modal" data-bs-target="#addUserModal">

        Add User
    </button>
</header>

<div class="container">

    <!-- Modal add user -->
    <div class="modal fade" id="addUserModal" tabindex="-1" aria-labelledby="addUserModalLabel" aria-hidden="true"
        #modelElemnt>
        <div class="modal-dialog">
            <div class="modal-content">
                <form #usersForm="ngForm" (ngSubmit)="saveUsers(usersForm)">
                    <div class="modal-header">
                        <h5 class="modal-title" id="addUserModalLabel"> {{!isUpdate?'Add User':'Update User'}}</h5>
                        <button type="button" class="btn-close" data-bs-dismiss="modal" aria-label="Close"></button>
                    </div>

                    <div class="modal-body">
                        <div class="mb-3">
                            <label for="Name" class="form-label">Name</label>
                            <input type="text" class="form-control" name="name" #name="ngModel"
                                [(ngModel)]="userObj.name" required>
                            <div *ngIf="name.invalid && name.touched" class="text-danger">
                                <span *ngIf="name.errors?.['required']">Name is required</span>
                                <span *ngIF="name.errors?.['minlength']">Minimum is character</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="Email" class="form-label">Email</label>
                            <input type="email" class="form-control" name="email" #email="ngModel"
                                [(ngModel)]="userObj.email" required>
                            <div *ngIf="email.invalid && email.touched" class="text-danger">
                                <span *ngIf="email.errors?.['required']">Email is required</span>
                                <span *ngIf="email.errors?.['email']">Enter a valid email</span>
                            </div>
                        </div>

                        <div class="mb-3">
                            <label for="Age" class="form-label">Age</label>
                            <input type="number" class="form-control" name="age" #age="ngModel"
                                [(ngModel)]="userObj.age" ngModel required>
                            <div *ngIf="age.invalid && age.touched" class="text-danger">
                                <span *ngIf="age.errors?.['required']">Age is required</span>
                                <span *ngIf="age.errors?.['min']">Age must at least 1</span>
                                <span *ngIf="age.errors?.['max']">Age can't exceed 120</span>
                            </div>
                        </div>
                    </div>

                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
                        <button type="submit" class="btn btn-primary" [disabled]="usersForm.invalid">Save</button>
                    </div>
                </form>

            </div>
        </div>
    </div>
    <!-- Trigger Button -->

    <!-- all data load -->

    <div class="table-responsive">
        <table class="table table-striped table-hover table-bordered text-center">
            <thead>
                <tr>
                    <th colspan="6">
                        <div class="input-group mb-3 w-50 mx-auto">
                            <span class="input-group-text bg-white"><i class="bi bi-search"></i></span>
                            <input type="text" class="form-control" placeholder="Search by name, email, age or ID"
                                (input)="searchTerm.set($any($event.target).value); currentPage.set(1)">
                        </div>
                    </th>

                </tr>
                <tr>
                    <th (click)="sortBy('id')" scope="col">Id <i [ngClass]="{
                    'bi bi-caret-up-fill': sortKey() === 'id' && sortOrder() === 'asc',
                    'bi bi-caret-down-fill': sortKey() === 'id' && sortOrder() === 'desc'
                }"></i></th>
                    <th (click)="sortBy('name')">Name <i [ngClass]="{
                    'bi bi-caret-up-fill': sortKey() === 'name' && sortOrder() === 'asc',
                    'bi bi-caret-down-fill': sortKey() === 'name' && sortOrder() === 'desc'
                }"></i></th>
                    <th (click)="sortBy('email')">Email <i [ngClass]="{
                    'bi bi-caret-up-fill': sortKey() === 'email' && sortOrder() === 'asc',
                    'bi bi-caret-down-fill': sortKey() === 'email' && sortOrder() === 'desc'
                }"></i></th>
                    <th (click)="sortBy('age')">Age <i [ngClass]="{
                    'bi bi-caret-up-fill': sortKey() === 'age' && sortOrder() === 'asc',
                    'bi bi-caret-down-fill': sortKey() === 'age' && sortOrder() === 'desc'
                }"></i></th>
                    <th colspan="2" scope="col">Action</th>
                </tr>
            </thead>
            <tbody>


                @for (user of paginatedUsers(); track user.id) {

                <tr>
                    <td scope="row">{{user.id}}</td>
                    <td>{{user.name | titlecase}}</td>
                    <td>{{user.email}}</td>
                    <td>{{user.age}}</td>
                    <td><a class="btn fs-5" (click)="updateUser(user)"><i class="bi bi-pencil-square me-2"></i></a>
                    </td>
                    <td><a class="btn fs-5" (click)="deleteUser(user)"> <i class="bi bi-trash text-danger"></i></a></td>
                </tr>
                }
                <!-- Spinner row at bottom -->
                <tr *ngIf="isLoading()">
                    <td colspan="6" class="text-center py-4">
                        <div class="spinner-border text-primary" role="status" style="opacity: 0.8;">
                            <span class="visually-hidden">Loading...</span>
                        </div>
                    </td>
                </tr>
            </tbody>
        </table>
        <nav *ngIf="totalPages() > 1">
            <ul class="pagination justify-content-center mt-3">
                <li class="page-item" [class.disabled]="currentPage() === 1">
                    <a class="page-link" (click)="prevPage()">Previous</a>
                </li>

                <li class="page-item" *ngFor="let page of [].constructor(totalPages()); let i = index"
                    [class.active]="currentPage() === i + 1">
                    <a class="page-link" (click)="goToPage(i + 1)">{{ i + 1 }}</a>
                </li>

                <li class="page-item" [class.disabled]="currentPage() === totalPages()">
                    <a class="page-link" (click)="nextPage()">Next</a>
                </li>
            </ul>
        </nav>
    </div>
</div>
<!-- toast -->
<app-toast></app-toast>
